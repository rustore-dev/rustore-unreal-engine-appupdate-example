<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android">

  <resourceCopies>
    <copyDir src="$S(PluginDir)/ThirdParty/Android/libs" dst="$S(BuildDir)/libs" />
  </resourceCopies>

  <androidManifestUpdates>
    <!-- For each activity -->
    <loopElements tag="activity">
      <!-- Find UE GameActivity -->
      <setStringFromAttribute result="activityName" tag="$" name="android:name" />
      <setBoolIsEqual result="bIsUE4GameActivity" arg1="$S(activityName)" arg2="com.epicgames.ue4.GameActivity" />
      <setBoolIsEqual result="bIsUE5GameActivity" arg1="$S(activityName)" arg2="com.epicgames.unreal.GameActivity" />
      <setBoolOr result="bIsGameActivity" arg1="$B(bIsUE4GameActivity)" arg2="$B(bIsUE5GameActivity)" />

      <!-- Add android:exported attribute for UE4 GameActivity -->
      <if condition="bIsUE4GameActivity">
        <true>
          <addAttribute tag="$" name="android:exported" value="true"/>
        </true>
      </if>

      <!-- For each activity -->
    </loopElements>
  </androidManifestUpdates>

  <buildGradleAdditions>
    <insert>
      ext.appupdate_type = ''
      
      if (project.hasProperty('rustore_sdk_type')) {
        appupdate_type = rustore_sdk_type
      }
      
      dependencies {
        // RuStore AppUpdate
        implementation("ru.rustore.sdk:appupdate:1.0.0$appupdate_type")
        implementation fileTree(include: ["RuStoreUnityAppUpdate${appupdate_type}.aar"], dir: 'src/main/libs')
      }
    </insert>
  </buildGradleAdditions>

</root>
